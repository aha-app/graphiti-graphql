# graphiti-graphql

Automatically generate a GraphQL schema from your [Graphiti](https://www.graphiti.dev) resources. Supports queries (including relationships/sideloads), filtering, sorting, and CRUD mutations.

## Status

This gem is in beta. It should generally work as advertised, but may not work as expected for particular use cases, especially with uncommon Graphiti configurations. You should carefully validate that it works with your particular use case.

Currently provided:

* Queryable schema for all of your Graphiti resources. Resources with the `graphql_entry` tag can be queried from the top level; other resources can be queried through sideloads/GraphQL object relationships (`belongs_to`, `has_many`, etc)
* Filtering and sorting (via the `filter` or `sort` arguments on any list relation)
* Create, update, and delete mutations for each resource

Not supported (yet):

* Only the built-in Graphiti attribute types are supported; fields with a custom type are omitted from the GraphQL schema
* All fields are denoted as nullable in the GraphQL schema, even if in practice some fields are guaranteed to have a value
* Similarly, no mutation arguments are required in the GraphQL schema, even if they are required by an underlying model validation
* There is no way to prevent certain resources from being queryable in the schema, if they are accessible via relationship from a resource with `graphql_entry`

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'graphiti-graphql'
```

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install graphiti-graphql

## Usage

1. Include the gem in your Graphiti `ApplicationResource`.

```ruby
# app/resources/application_resource.rb
class ApplicationResource < Graphiti::Resource
  include Graphiti::GraphQL::Resource

  # ...
end
```

2. Add `graphql_entry` to any resources which should be available as a top-level queryable resource in GraphQL.

```ruby
# app/resources/post_resource.rb
class PostResource < ApplicationResource
  graphql_entry

  # ...
end
```

3. Run the [graphql-ruby](https://graphql-ruby.org/getting_started) generator and follow their setup. Once you've got a GraphQL controller, resolve queries through the autogenerated Graphiti schema instead of the default stub that graphql-ruby providers:

```ruby
# app/controllers/graphql_controller.rb
class GraphqlController < ActionController::Base
  def execute
    # ...

    # By default, graphql-ruby will generate you a schema:
    result = YourAppSchema.execute(query, variables: variables, context: context, operation_name: operation_name)

    # Replace it with:
    result = ApplicationResource.graphql_schema.execute(query, variables: variables)

    # ...
  end
end
```

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake spec` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/aha-app/graphiti-graphql.

## Credits

* The code for this gem was originally based on [wade-tandy/graphiti-graphql](https://github.com/wadetandy/graphiti-graphql).
* Some testing patterns and fixtures were borroed from Graphiti itself.

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
